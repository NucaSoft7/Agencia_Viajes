<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destinos Fantásticos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="destinations.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="index.html">Agencia de Viajes Fantástica</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Volver al Inicio</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container py-5">
        <h1>Nuestros Destinos</h1>
        <div id="destinations-container" class="row">
            <!-- Destinations will be dynamically added here -->
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        $(document).ready(function () {
            // Function to fetch and display destinations
            function loadDestinations() {
                // Function to extract query parameters from the URL
                function getParameterByName(name, url = window.location.href) {
                    name = name.replace(/[\[\]]/g, '\\$&');
                    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                        results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, ' '));
                }

                const destinationName = getParameterByName('destination');

                $.ajax({
                    url: 'script.js', // Fetch the script to access allPackages
                    dataType: 'script',
                    success: function () {
                        if (typeof allPackages !== 'undefined') {
                            const destinationsContainer = $('#destinations-container');
                            destinationsContainer.empty();
                            /* <div class="container package-details-container">
    <h1 id="package-name"></h1>
    <h2 id="package-destination"></h2>
    <p>Sitios incluidos en este paquete:</p>
    <ul id="package-sites">
    </ul>
</div>
*/
                            /* Esta parte de codigo debe integrar un boton para agregar destino o guardar un stio favorito
                                                        // Group packages by destination
                                                        const groupedPackages = allPackages.reduce((acc, pkg) => {
                                                            if (!acc[pkg.destination]) {
                                                                acc[pkg.destination] = [];
                                                            }
                                                            acc[pkg.destination].push(pkg);
                                                            return acc;
                                                        }, {});
                            
                                                        // Create HTML for each destination
                                                        $.each(groupedPackages, function (destination, packages) {
                                                            let packagesHTML = '';
                                                            packages.forEach(pkg => {
                                                                packagesHTML += `<li class="list-group-item">${pkg.name}</li>`;
                                                            });
                            
                                                            const destinationHTML = `
                                                                <div class="col-md-6 mb-4">
                                                                    <div class="card">
                                                                        <div class="card-body">
                                                                            <h5 class="card-title">${destination}</h5>
                                                                            <p class="card-text">Paquetes disponibles:</p>
                                                                            <ul class="list-group list-group-flush">
                                                                                ${packagesHTML}
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            `;
                                                            destinationsContainer.append(destinationHTML);
                                                        });
                                                        */


                            if (!destinationName) {
                                destinationsContainer.html('<p>Por favor, seleccione un destino.</p>');
                                return;
                            }

                            // Find packages matching the selected destination
                            const selectedPackages = allPackages.filter(pkg => pkg.destination === destinationName);

                            if (selectedPackages.length === 0) {
                                destinationsContainer.html('<p>Destino no encontrado.</p>');
                                return;
                            }

                            // Display details for the selected destination
                            selectedPackages.forEach(pkg => {
                                destinationsContainer.append(`<h2><b>${pkg.destination}</b></h2>`);


                                // Add "About" section
                                destinationsContainer.append(`
                                    <div class="col-md-12 mb-4">
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title"><em>Acerca de ${pkg.destination}</em></h5>
                                                <p class="card-text">${pkg.about || 'Información no disponible.'}</p>
                                            </div>
                                        </div>
                                    </div>
                                `);

                                // Split the description into sites (assuming comma-separated)
                                const sites = pkg.description.split(', ');
                                sites.forEach(site => {
                                    destinationsContainer.append(`
                                        <div class="col-md-12 mb-4">
                                            <div class="card">
                                                <img src="${pkg.image}" class="card-img-top" alt="${site}">
                                                <div class="card-body">
                                                    <h5 class="card-title"><em>${site}</em></h5>
                                                    <p class="card-text">Más información sobre ${site} aquí.</p>
                                                </div>
                                            </div>
                                        </div>
                                    `);

                                    /*/ Split the description into sites (assuming comma-separated)
                                    const sites = pkg.description.split(', ');
                                    sites.forEach(site => {
                                        destinationsContainer.append(`<div class="col-md-12 mb-4"><div class="card"><div class="card-body"><h5 class="card-title">${site}</h5></div></div></div>`);
                                        **/
                                });
                            });

                        } else {
                            $('#destinations-container').html('<p>Error: No se pudieron cargar los destinos.</p>');
                        }
                    },
                    error: function () {
                        $('#destinations-container').html('<p>Error al cargar el script.</p>');
                    }
                });
            }

            loadDestinations();
        });
    </script>
</body>

</html>